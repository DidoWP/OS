Такаа
Имам първо 2 проверки съответно за броя аргументи подадени при извикването на скрипта и една за това дали тези имена на файлове съществуват или не. При несъответсвие приключвам скрипта с подходящ exit код.
Създавам 2 временни директории, 2 директории за ok и failed резултатите и един файл за резултатите.
Полсле позлвам ънзип за да разархивирам moodle-ския файл като ползвам -q за да не вади инфо за процеса на разархивиране и с -d давам директорията където да се изсипят резултатире.
С find взимам пътят до архивите и си ги запазвам в едната временна директория и пускам един цикъл през всичките резултати
Взимам си ФН и променливи със стойност 1циа с идеята ако изпълняват условията да си ги сменям на 0ли и накрая да ги записа във резултатния файл
Проверявам си първо формата после името на архива и съответно сменям стойностите на променливите отговарящи за това
Правя още една временна директория в която да пазя резулатите от разархивирането. Идеята е да мога да обработя нещата в архива и при несъответствия в името на директорията вътре да мога да я изпратя към ok файла с правилно име. Ако обаче типа на файла не е в списъка с форматите се създава директория в $3 или иначе казано filed директорията и се копира архива там.
Тука имам един малко по интересен awk. Вкарал съм му една от локалните ми променливи с -v и съм задал с RS=';' разделителят да не е нов ред а да е ; (това го видях в стак овърфлол). Awk-а чете от друга променлива където съм събрал видовете файлове, които ще разархивираме. Ако формата на текущия архив съвпадне с един от изброените от мен типове влизам в следващия if.
В следващия if съм сложил разархивирането като съм разделил различните команди да разархивиране с || така ако командите ще се изпълняват до успех т.е. до първата команда която върне exit код 0.
Във вътрешните 2 if-a проверявам другите 2 неща които трябва да се отбележат в резултатния файл.
Накрая създавам по една директория в $2 и се копирам вътре нещата 2 нива по-надолу от архива.
Линкове към сайтове, които съм ползвал
https://stackoverflow.com/questions/43250592/awk-to-read-file-as-a-whole - за схемата с RS за awk
https://linuxize.com/post/how-to-unzip-files-in-linux/ - работа с unzip
https://www.tecmint.com/how-to-open-extract-and-create-rar-files-in-linux/ - работа с unrar
